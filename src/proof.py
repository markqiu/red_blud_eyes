"""
çº¢è“çœ¼è°œé¢˜çš„æ•°å­¦è¯æ˜å’Œæ·±åº¦è§£æ

æœ¬æ¨¡å—å›ç­”ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š
1. æ¸¸å®¢çš„å®£å¸ƒåˆ°åº•å¸¦æ¥äº†ä»€ä¹ˆå®è´¨æ€§å˜åŒ–ï¼Ÿ
2. ä¸ºä»€ä¹ˆæ‘æ°‘éƒ½ä¼šçŸ¥é“çº¢çœ¼ç›ä¼šåœ¨ç¬¬ N å¤©ç¦»å¼€ï¼Ÿ
"""

from dataclasses import dataclass, field
from typing import Optional
from .puzzle import EyeColor


@dataclass
class MentalModel:
    """
    å¿ƒæ™ºæ¨¡å‹ï¼šä¸€ä¸ªæ‘æ°‘å¯¹ä¸–ç•Œçš„å‡è®¾æ€§ç†è§£
    
    è¿™æ˜¯ç†è§£çº¢è“çœ¼è°œé¢˜çš„å…³é”®æ•°æ®ç»“æ„ï¼
    æ¯ä¸ªæ‘æ°‘å¿ƒä¸­éƒ½æœ‰ä¸€ä¸ª"å‡è®¾ä¸–ç•Œæ ‘"ï¼Œè¡¨ç¤ºï¼š
    "å¦‚æœæˆ‘æ˜¯è“çœ¼ç›ï¼Œé‚£ä¹ˆä¸–ç•Œæ˜¯ä»€ä¹ˆæ ·ï¼Ÿ"
    """
    
    # å‡è®¾è€…çš„ ID
    thinker_id: int
    
    # å‡è®¾ï¼š"æˆ‘æ˜¯è“çœ¼ç›" (å› ä¸ºæ‘æ°‘çœ‹ä¸åˆ°è‡ªå·±)
    assumed_self_is_blue: bool = True
    
    # åœ¨è¿™ä¸ªå‡è®¾ä¸‹ï¼Œä¸–ç•Œä¸Šæœ‰å¤šå°‘çº¢çœ¼ç›ï¼Ÿ
    assumed_red_count: int = 0
    
    # é€’å½’æ·±åº¦ï¼ˆç¬¬å‡ å±‚å‡è®¾ï¼‰
    depth: int = 0
    
    # å­å‡è®¾ï¼ˆ"å¦‚æœæˆ‘æ˜¯è“çœ¼ç›ï¼Œé‚£ä¸ªçº¢çœ¼ç›çš„äººä¼šæ€ä¹ˆæƒ³..."ï¼‰
    sub_hypothesis: Optional['MentalModel'] = None
    
    def __repr__(self) -> str:
        indent = "  " * self.depth
        return f"{indent}æ·±åº¦{self.depth}: å‡è®¾æœ‰{self.assumed_red_count}ä¸ªçº¢çœ¼ç›"


def build_mental_model_tree(
    villager_id: int,
    villager_sees_red: int,
    villager_is_red: bool,
    max_depth: int = 10
) -> MentalModel:
    """
    æ„å»ºä¸€ä¸ªæ‘æ°‘çš„å®Œæ•´å¿ƒæ™ºæ¨¡å‹æ ‘
    
    è¿™å°±æ˜¯"å…¬å…±çŸ¥è¯†"åœ¨ç¨‹åºä¸­çš„çœŸæ­£ä½“ç°ï¼
    
    Args:
        villager_id: æ‘æ°‘ID
        villager_sees_red: è¿™ä¸ªæ‘æ°‘çœ‹åˆ°çš„çº¢çœ¼ç›æ•°é‡
        villager_is_red: è¿™ä¸ªæ‘æ°‘å®é™…ä¸Šæ˜¯å¦æ˜¯çº¢çœ¼ç›
        max_depth: æœ€å¤§é€’å½’æ·±åº¦
    
    Returns:
        å®Œæ•´çš„å¿ƒæ™ºæ¨¡å‹æ ‘
    """
    
    def build_recursive(assumed_red_count: int, depth: int) -> Optional[MentalModel]:
        if depth > max_depth or assumed_red_count < 0:
            return None
        
        model = MentalModel(
            thinker_id=villager_id,
            depth=depth,
            assumed_red_count=assumed_red_count
        )
        
        # é€’å½’ï¼šå¦‚æœæœ‰ k ä¸ªçº¢çœ¼ç›ï¼Œå…¶ä¸­ä¸€ä¸ªçº¢çœ¼ç›ä¼šå‡è®¾åªæœ‰ k-1 ä¸ª
        if assumed_red_count > 0:
            model.sub_hypothesis = build_recursive(assumed_red_count - 1, depth + 1)
        
        return model
    
    # çº¢çœ¼ç›æ‘æ°‘çœ‹åˆ°çš„æ•°é‡ = å®é™…æ•°é‡ - 1ï¼ˆçœ‹ä¸åˆ°è‡ªå·±ï¼‰
    # æ‰€ä»¥ä»–å‡è®¾çš„æƒ…å†µæ˜¯ "å¦‚æœæˆ‘æ˜¯è“çœ¼ç›ï¼Œé‚£å°±åªæœ‰æˆ‘çœ‹åˆ°çš„é‚£äº›çº¢çœ¼ç›"
    return build_recursive(villager_sees_red, depth=0)


@dataclass
class RecursiveReasoning:
    """
    é€’å½’æ¨ç†è¿‡ç¨‹
    
    è¿™ä¸ªç±»å±•ç¤ºäº†ä¸ºä»€ä¹ˆ N ä¸ªçº¢çœ¼ç›ä¼šåœ¨ç¬¬ N å¤©ç¦»å¼€
    """
    
    actual_red_count: int
    verbose: bool = True
    
    def explain_why_n_days(self) -> str:
        """
        è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦ N å¤©
        
        æ ¸å¿ƒé€»è¾‘ï¼š
        - æ¯ä¸ªçº¢çœ¼ç›çœ‹åˆ° N-1 ä¸ªçº¢çœ¼ç›
        - ä»–æƒ³ï¼š"å¦‚æœæˆ‘æ˜¯è“çœ¼ç›ï¼Œé‚£åªæœ‰ N-1 ä¸ªçº¢çœ¼ç›"
        - "å¦‚æœåªæœ‰ N-1 ä¸ªçº¢çœ¼ç›ï¼Œä»–ä»¬åº”è¯¥åœ¨ç¬¬ N-1 å¤©ç¦»å¼€"
        - ç¬¬ N-1 å¤©æ²¡äººç¦»å¼€ â†’ æˆ‘ä¹Ÿæ˜¯çº¢çœ¼ç›ï¼
        - æ‰€ä»¥ç¬¬ N å¤©ç¦»å¼€
        """
        n = self.actual_red_count
        
        lines = [
            f"\n{'='*60}",
            f"ğŸ“ æ•°å­¦è¯æ˜ï¼šä¸ºä»€ä¹ˆ {n} ä¸ªçº¢çœ¼ç›åœ¨ç¬¬ {n} å¤©ç¦»å¼€",
            f"{'='*60}",
        ]
        
        # ç”¨â€œn=1, n=2, n=3 ...â€é“¾æ¡æ–¹å¼è®²æ¸…æ¥šï¼š
        # â€œä»–ä»¬åº”è¯¥åœ¨ç¬¬Nå¤©ç¦»å¼€â€ä¸æ˜¯è§„åˆ™ï¼Œè€Œæ˜¯ä» n=1 é€’æ¨å¾—å‡ºçš„ç»“è®ºã€‚
        lines.extend([
            "\nã€æ¨ç†è¿‡ç¨‹ï¼ˆå½’çº³é“¾æ¡ï¼‰ã€‘\n",
            "n=1: å”¯ä¸€çš„çº¢çœ¼ç›çœ‹åˆ°0ä¸ªï¼Œæ¸¸å®¢è¯´è‡³å°‘æœ‰1ä¸ª â†’ æˆ‘æ˜¯çº¢çœ¼ç› â†’ ç¬¬1å¤©ç¦»å¼€",
            "    â†“ (è¿™æ˜¯å”¯ä¸€ç›´æ¥ä»è§„åˆ™æ¨å‡ºçš„ï¼)",
            "n=2: æ¯äººçœ‹åˆ°1ä¸ªçº¢çœ¼ç›ï¼Œå‡è®¾\"å¦‚æœæˆ‘æ˜¯è“çœ¼ç›ï¼Œé‚£åªæœ‰1ä¸ªçº¢çœ¼ç›\"",
            "     æ ¹æ®n=1çš„ç»“è®ºï¼Œé‚£ä¸ªäººåº”è¯¥ç¬¬1å¤©ç¦»å¼€",
            "     ç¬¬1å¤©æ²¡äººç¦»å¼€ â†’ æˆ‘çš„å‡è®¾é”™äº† â†’ æˆ‘ä¹Ÿæ˜¯çº¢çœ¼ç› â†’ ç¬¬2å¤©ç¦»å¼€",
            "    â†“",
            "n=3: æ¯äººçœ‹åˆ°2ä¸ªçº¢çœ¼ç›ï¼Œå‡è®¾\"å¦‚æœæˆ‘æ˜¯è“çœ¼ç›ï¼Œé‚£åªæœ‰2ä¸ªçº¢çœ¼ç›\"",
            "     æ ¹æ®n=2çš„ç»“è®ºï¼Œé‚£2ä¸ªäººåº”è¯¥ç¬¬2å¤©ç¦»å¼€",
            "     ç¬¬2å¤©æ²¡äººç¦»å¼€ â†’ æˆ‘çš„å‡è®¾é”™äº† â†’ æˆ‘ä¹Ÿæ˜¯çº¢çœ¼ç› â†’ ç¬¬3å¤©ç¦»å¼€",
            "    â†“",
            "...ä»¥æ­¤ç±»æ¨",
            "",
            f"æ‰€ä»¥ï¼šå‡å¦‚æœ‰ N ä¸ªçº¢çœ¼ç›ï¼Œé‚£ä¹ˆçº¢çœ¼ç›ä»¬å°±åº”è¯¥åœ¨ç¬¬ N å¤©ç¦»å¼€ã€‚ï¼ˆè¿™é‡Œ N={n}ï¼‰",
        ])
        
        return "\n".join(lines)
    
    def simulate_thinking(self, villager_id: int, sees_red: int) -> list[str]:
        """
        æ¨¡æ‹Ÿä¸€ä¸ªæ‘æ°‘çš„å®Œæ•´æ€è€ƒè¿‡ç¨‹
        """
        logs = []
        n = sees_red  # çœ‹åˆ°çš„çº¢çœ¼ç›æ•°é‡
        
        logs.append(f"\nğŸ§  æ‘æ°‘ {villager_id} çš„æ€è€ƒè¿‡ç¨‹:")
        logs.append(f"   æˆ‘çœ‹åˆ° {n} ä¸ªçº¢çœ¼ç›")
        
        if n == 0:
            logs.append("   æ¸¸å®¢è¯´è‡³å°‘æœ‰1ä¸ªçº¢çœ¼ç›ï¼Œä½†æˆ‘çœ‹åˆ°0ä¸ª")
            logs.append("   ç»“è®ºï¼šæˆ‘æ˜¯é‚£ä¸ªçº¢çœ¼ç›ï¼ç¬¬1å¤©ç¦»å¼€")
            return logs
        
        # é€’å½’æ€è€ƒ
        logs.append(f"\n   ã€é€’å½’æ¨ç†ã€‘")
        logs.append(f"   å‡è®¾æˆ‘æ˜¯è“çœ¼ç›...")
        logs.append(f"   é‚£ä¹ˆæ‘é‡Œåªæœ‰ {n} ä¸ªçº¢çœ¼ç›")
        
        for day in range(1, n + 2):
            if day <= n:
                logs.append(f"\n   ç¬¬{day}å¤©:")
                if day < n:
                    logs.append(f"   - å¦‚æœåªæœ‰{n}ä¸ªçº¢çœ¼ç›ï¼Œç¬¬{n}å¤©ä»–ä»¬æ‰ä¼šç¦»å¼€")
                    logs.append(f"   - ä»Šå¤©æ‰ç¬¬{day}å¤©ï¼Œæˆ‘éœ€è¦ç­‰å¾…...")
                elif day == n:
                    logs.append(f"   - å¦‚æœåªæœ‰{n}ä¸ªçº¢çœ¼ç›ï¼Œä»Šå¤©ä»–ä»¬åº”è¯¥ç¦»å¼€")
                    logs.append(f"   - è§‚å¯Ÿï¼šæ²¡æœ‰äººç¦»å¼€ï¼")
            else:
                logs.append(f"\n   ç¬¬{day}å¤©:")
                logs.append(f"   - æ˜¨å¤©é‚£{n}ä¸ªçº¢çœ¼ç›æ²¡ç¦»å¼€")
                logs.append(f"   - è¯´æ˜ä»–ä»¬æ¯äººä¹Ÿçœ‹åˆ°äº†{n}ä¸ªçº¢çœ¼ç›")
                logs.append(f"   - æˆ‘åªçœ‹åˆ°{n}ä¸ªï¼Œå¦‚æœæˆ‘æ˜¯è“çœ¼ç›ï¼Œä»–ä»¬åº”è¯¥åªçœ‹åˆ°{n-1}ä¸ª")
                logs.append(f"   - çŸ›ç›¾ï¼å”¯ä¸€è§£é‡Šï¼šæˆ‘ä¹Ÿæ˜¯çº¢çœ¼ç›")
                logs.append(f"   - ç»“è®ºï¼šæˆ‘å¿…é¡»ä»Šå¤©ç¦»å¼€ï¼")
        
        return logs


@dataclass 
class AnnouncementEffect:
    """
    å…¬å¼€å®£å¸ƒçš„æ•ˆæœåˆ†æ
    
    å›ç­”æ ¸å¿ƒé—®é¢˜ï¼šå®£å¸ƒåˆ°åº•æ”¹å˜äº†ä»€ä¹ˆï¼Ÿ
    """
    
    num_red: int
    num_blue: int
    
    def analyze_before_announcement(self) -> dict:
        """åˆ†æå®£å¸ƒå‰çš„çŠ¶æ€"""
        return {
            "çŸ¥è¯†ç±»å‹": "å…±æœ‰çŸ¥è¯†ï¼ˆæœ‰é™é˜¶ï¼‰",
            "æœ€å¤§çŸ¥è¯†é˜¶æ•°": self.num_red - 1,
            "å…¬å…±æ—¶é—´èµ·ç‚¹": None,
            "æ¨ç†å¯ä»¥å¯åŠ¨": False,
            "å…³é”®å˜é‡ announcement_made": False,
            "å…³é”®å˜é‡ day": "æ— æ„ä¹‰ï¼ˆæ²¡æœ‰è®¡æ—¶èµ·ç‚¹ï¼‰",
        }
    
    def analyze_after_announcement(self) -> dict:
        """åˆ†æå®£å¸ƒåçš„çŠ¶æ€"""
        return {
            "çŸ¥è¯†ç±»å‹": "å…¬å…±çŸ¥è¯†ï¼ˆæ— é™é˜¶ï¼‰",
            "æœ€å¤§çŸ¥è¯†é˜¶æ•°": float('inf'),
            "å…¬å…±æ—¶é—´èµ·ç‚¹": "å®£å¸ƒçš„é‚£ä¸€åˆ»",
            "æ¨ç†å¯ä»¥å¯åŠ¨": True,
            "å…³é”®å˜é‡ announcement_made": True,
            "å…³é”®å˜é‡ day": "ä»1å¼€å§‹è®¡æ•°",
        }
    
    def explain_the_change(self) -> str:
        """
        è¯¦ç»†è§£é‡Šå®£å¸ƒå¸¦æ¥çš„å˜åŒ–
        
        è¿™æ˜¯æœ€å…³é”®çš„éƒ¨åˆ†ï¼
        """
        lines = [
            "\n" + "=" * 70,
            "ğŸ”‘ æ¸¸å®¢å®£å¸ƒåˆ°åº•æ”¹å˜äº†ä»€ä¹ˆï¼Ÿï¼ˆç¨‹åºå˜é‡å±‚é¢çš„è§£ç­”ï¼‰",
            "=" * 70,
            
            "\nã€è¡¨é¢å˜åŒ–ã€‘",
            "  åªæœ‰ä¸€ä¸ªå¸ƒå°”å˜é‡: announcement_made = True",
            
            "\nã€æ·±å±‚å˜åŒ– 1: å»ºç«‹å…¬å…±æ—¶é—´èµ·ç‚¹ã€‘",
            "  - å®£å¸ƒå‰: day å˜é‡æ²¡æœ‰æ„ä¹‰",
            "  - å®£å¸ƒå: day = 1, 2, 3, ... å¼€å§‹è®¡æ—¶",
            "  - ç¨‹åºä¸­: village.current_day ä» 0 å˜æˆæœ‰æ„ä¹‰çš„è®¡æ•°å™¨",
            "  - æ„ä¹‰: æ‰€æœ‰æ‘æ°‘çš„æ¨ç†æœ‰äº†åŒæ­¥çš„æ—¶é—´å‚ç…§ç³»",
            
            "\nã€æ·±å±‚å˜åŒ– 2: çŸ¥è¯†å±‚çº§çªå˜ã€‘",
            f"  - å®£å¸ƒå‰: knowledge.level = {self.num_red - 1} (æœ€é«˜{self.num_red - 1}é˜¶)",
            "  - å®£å¸ƒå: knowledge.level = -1 (æ— é™é˜¶ï¼Œå³å…¬å…±çŸ¥è¯†)",
            "  - ç¨‹åºä¸­: CommonKnowledge.is_common = True",
            
            "\nã€æ·±å±‚å˜åŒ– 3: å¯åŠ¨é€’å½’æ¨ç†é“¾ã€‘",
            "  - å®£å¸ƒå‰: reason_and_decide() ç›´æ¥è¿”å› False",
            "  - å®£å¸ƒå: è¿›å…¥å®Œæ•´çš„æ¨ç†é€»è¾‘",
            "  - ç¨‹åºä¸­: if not public_announcement_made: return False",
            
            "\nã€æ ¸å¿ƒæ´å¯Ÿã€‘",
            "  å®£å¸ƒçš„æœ¬è´¨ä½œç”¨æ˜¯å»ºç«‹ã€Œå…¬å…±çŸ¥è¯†ã€ï¼š",
            "  - æ¯ä¸ªäººçŸ¥é“å‘½é¢˜ p",
            "  - æ¯ä¸ªäººçŸ¥é“ã€Œæ¯ä¸ªäººçŸ¥é“ pã€",
            "  - æ¯ä¸ªäººçŸ¥é“ã€Œæ¯ä¸ªäººçŸ¥é“ã€æ¯ä¸ªäººçŸ¥é“ pã€ã€",
            "  - ... æ— é™åµŒå¥—",
            "",
            "  è¿™ç§æ— é™åµŒå¥—çš„çŸ¥è¯†ä½¿å¾—é€’å½’æ¨ç†æˆä¸ºå¯èƒ½ï¼š",
            f"  - n ä¸ªçº¢çœ¼ç›ï¼Œæ¯äººçœ‹åˆ° n-1 ä¸ª",
            f"  - æ¯äººå‡è®¾ã€Œå¦‚æœæˆ‘æ˜¯è“çœ¼ç›ï¼Œé‚£å°±åªæœ‰ n-1 ä¸ªçº¢çœ¼ç›ã€",
            f"  - æ ¹æ®å…¬å…±çŸ¥è¯†ï¼Œé‚£ n-1 ä¸ªäººåº”è¯¥åœ¨ç¬¬ n-1 å¤©ç¦»å¼€",
            f"  - ç¬¬ n-1 å¤©æ²¡äººç¦»å¼€ â†’ å‡è®¾é”™è¯¯ â†’ æˆ‘ä¹Ÿæ˜¯çº¢çœ¼ç›",
            f"  - ç¬¬ n å¤©æ‰€æœ‰çº¢çœ¼ç›åŒæ—¶ç¦»å¼€",
        ]
        
        return "\n".join(lines)
    
    def show_knowledge_hierarchy(self) -> str:
        """å±•ç¤ºçŸ¥è¯†å±‚çº§çš„å˜åŒ–"""
        n = self.num_red
        lines = [
            "\n" + "=" * 70,
            "ğŸ“š çŸ¥è¯†å±‚çº§ç¤ºæ„å›¾",
            "=" * 70,
            
            "\nã€å®£å¸ƒå‰çš„çŸ¥è¯†å±‚çº§ã€‘",
        ]
        
        for level in range(min(n, 5)):
            prefix = "  " * level
            if level == 0:
                lines.append(f"  pâ‚€ = 'å­˜åœ¨çº¢çœ¼ç›'")
            else:
                nested = "E(" * level + "pâ‚€" + ")" * level
                lines.append(f"  p{level} = {nested}")
                lines.append(f"       = '{'æ‰€æœ‰äººçŸ¥é“' * level}å­˜åœ¨çº¢çœ¼ç›'")
        
        if n > 1:
            lines.append(f"\n  âŒ p{n} æ— æ³•å»ºç«‹ï¼")
            lines.append(f"     å› ä¸ºçº¢çœ¼ç›åªçœ‹åˆ° {n-1} ä¸ªçº¢çœ¼ç›")
            lines.append(f"     ä»–ä»¬æ— æ³•ç¡®å®šã€Œæ‰€æœ‰äººéƒ½çŸ¥é“...ï¼ˆ{n}å±‚åµŒå¥—ï¼‰ã€")
        
        lines.extend([
            "\nã€å®£å¸ƒåçš„çŸ¥è¯†å±‚çº§ã€‘",
            "  pâ‚€ = 'å­˜åœ¨çº¢çœ¼ç›'",
            "  pâ‚ = E(pâ‚€) âœ…",
            "  pâ‚‚ = E(pâ‚) âœ…",
            "  ...",
            "  pâˆ = å…¬å…±çŸ¥è¯† âœ…",
            "",
            "  æ¸¸å®¢çš„å®£å¸ƒç¬é—´å»ºç«‹äº†æ— é™é˜¶çš„å…¬å…±çŸ¥è¯†ï¼",
        ])
        
        return "\n".join(lines)


def demonstrate_mental_models(num_red: int) -> str:
    """
    æ¼”ç¤ºæ¯ä¸ªçº¢çœ¼æ‘æ°‘çš„å¿ƒæ™ºæ¨¡å‹
    
    è¿™æ˜¯ç†è§£è°œé¢˜çš„å…³é”®ï¼
    """
    lines = [
        "\n" + "=" * 70,
        f"ğŸ§  å¿ƒæ™ºæ¨¡å‹æ¼”ç¤º: {num_red} ä¸ªçº¢çœ¼ç›çš„æƒ…å†µ",
        "=" * 70,
    ]
    
    lines.extend([
        f"\næ¯ä¸ªçº¢çœ¼ç›çœ‹åˆ°: {num_red - 1} ä¸ªçº¢çœ¼ç›",
        "\nã€ç¬¬1å±‚å‡è®¾ã€‘",
        f"  'å¦‚æœæˆ‘æ˜¯è“çœ¼ç›ï¼Œé‚£å°±åªæœ‰ {num_red - 1} ä¸ªçº¢çœ¼ç›'",
    ])
    
    if num_red >= 2:
        lines.extend([
            f"\nã€ç¬¬2å±‚å‡è®¾ã€‘(ç«™åœ¨å¦ä¸€ä¸ªçº¢çœ¼ç›çš„è§’åº¦)",
            f"  'å¦‚æœæˆ‘æ˜¯è“çœ¼ç›ï¼Œè€Œä¸”é‚£ä¸ªäººä¹Ÿå‡è®¾ä»–æ˜¯è“çœ¼ç›ï¼Œ",
            f"   é‚£å°±åªæœ‰ {num_red - 2} ä¸ªçº¢çœ¼ç›'",
        ])
    
    if num_red >= 3:
        lines.extend([
            f"\nã€ç¬¬3å±‚å‡è®¾ã€‘",
            f"  '...é‚£å°±åªæœ‰ {num_red - 3} ä¸ªçº¢çœ¼ç›'",
        ])
    
    lines.extend([
        "\nã€é€’å½’çš„ç»ˆç‚¹ã€‘",
        "  æœ€æ·±å±‚å‡è®¾: 'åªæœ‰1ä¸ªçº¢çœ¼ç›'",
        "  é‚£ä¸ªäººçœ‹åˆ°0ä¸ªçº¢çœ¼ç›ï¼Œç¬¬1å¤©åº”è¯¥ç¦»å¼€",
        "  å¦‚æœç¬¬1å¤©æ²¡äººç¦»å¼€ï¼Œè¯´æ˜ä¸æ­¢1ä¸ª...",
        "  å¦‚æœç¬¬2å¤©æ²¡äººç¦»å¼€ï¼Œè¯´æ˜ä¸æ­¢2ä¸ª...",
        f"  å¦‚æœç¬¬{num_red-1}å¤©æ²¡äººç¦»å¼€ï¼Œè¯´æ˜æˆ‘ä¹Ÿæ˜¯çº¢çœ¼ç›ï¼",
        f"  ç¬¬{num_red}å¤©ï¼Œæ‰€æœ‰äººåŒæ—¶ç¦»å¼€ï¼",
    ])
    
    return "\n".join(lines)


def run_proof():
    """è¿è¡Œå®Œæ•´çš„è¯æ˜æ¼”ç¤º"""
    print("\n" + "ğŸ”´ğŸ”µ" * 30)
    print("\nçº¢è“çœ¼è°œé¢˜ï¼šæ ¸å¿ƒé—®é¢˜è§£ç­”\n")
    print("ğŸ”´ğŸ”µ" * 30)
    
    # é—®é¢˜1: å®£å¸ƒå¸¦æ¥äº†ä»€ä¹ˆå˜åŒ–
    effect = AnnouncementEffect(num_red=3, num_blue=2)
    print(effect.explain_the_change())
    print(effect.show_knowledge_hierarchy())
    
    # é—®é¢˜2: ä¸ºä»€ä¹ˆç¬¬Nå¤©ç¦»å¼€
    reasoning = RecursiveReasoning(actual_red_count=3)
    print(reasoning.explain_why_n_days())
    
    # æ¼”ç¤ºå¿ƒæ™ºæ¨¡å‹
    print(demonstrate_mental_models(3))
    
    # æ¨¡æ‹Ÿä¸€ä¸ªæ‘æ°‘çš„æ€è€ƒ
    print("\n" + "-" * 70)
    for log in reasoning.simulate_thinking(villager_id=1, sees_red=2):
        print(log)


if __name__ == "__main__":
    run_proof()
